# Google Play ストアへの申請手引書

Google Play ストアへアプリを公開するための詳細な手順です。
大きく分けて「アカウント作成」「アプリの署名とビルド」「ストア情報の登録」「審査提出」の4ステップがあります。

## 1. Google Play Developer アカウントの作成

ストアにアプリを公開するには、開発者アカウントが必要です。

1. [Google Play Console](https://play.google.com/console/signup) にアクセスします。
2. Googleアカウントでログインし、画面の指示に従って登録します。
3. **登録料（25ドル、一度のみ）** の支払いが必要です。
4. 本人確認（身分証のアップロード）を行い、アカウントが有効になるのを待ちます（数日かかる場合があります）。

## 2. 公開用アプリバンドル (.aab) の作成

Android Studioを使って、ストア提出用のファイル（Signed App Bundle）を作成します。

1. **Android Studio** でプロジェクトを開きます (`npx cap open android`)。
2. メニューバーの **Build > Generate Signed Bundle / APK** を選択します。
3. **Android App Bundle** を選択し、Next を押します。
4. **Key store path** の下の **Create new...** を選択します（これがアプリの「印鑑」になります）。
    - **Path**: 保存場所を選びます（プロジェクト外の安全な場所に保存し、**絶対に紛失しないでください**）。
    - **Password**: パスワードを設定します。
    - **Alias / Password**: キーの別名とパスワードを設定します（Key storeと同じで構いません）。
    - **Certificate**: あなたの情報を入力します（First and Last Name と Country Code (JP) くらいでOK）。
5. Key store の設定ができたら Next を押し、**Release** を選択して **Create** を押します。
6. ビルドが完了すると右下に通知が出るので、`locate` を押して `.aab` ファイル（例: `app-release.aab`）の場所を確認しておきます。

## 3. Play Console でのアプリ登録

1. [Google Play Console](https://play.google.com/console/) にログインします。
2. **アプリの作成** ボタンを押します。
3. アプリ名（MathMaster）、デフォルトの言語（日本語）、アプリの種類（アプリ）、無料/有料（無料）を選択します。
4. **ダッシュボード** に「アプリのセットアップ」というタスクリストが表示されるので、順に進めます。
    - **プライバシーポリシー**: URLを入力（無い場合はブログやGoogleドキュメント等で作成して公開する必要があります）。
    - **アプリのアクセス権**: 「アクセス権なし」を選択。
    - **広告**: 「広告を含まない」を選択。
    - **コンテンツのレーティング**: アンケートに答えて年齢区分を決定します（教育アプリなら全年齢対象になりやすいです）。
    - **ターゲットユーザー**: 対象年齢（例: 6-8歳, 9-12歳など）を選択。
    - **ニュースアプリ**: 「いいえ」。
    - **COVID-19**: 「いいえ」。
    - **データセーフティ**: 収集するデータについて回答（今回はLocalStorageのみで外部送信しないなら「収集しない」）。
    - **政府用アプリ**: 「いいえ」。
    - **ストアの掲載情報**: 
        - 簡単な説明（80文字）、詳しい説明（4000文字以内）
        - アプリアイコン（512x512 PNG）
        - フィーチャーグラフィック（1024x500 PNG）
        - スクリーンショット（スマホ用2枚以上、7インチタブレット用、10インチタブレット用）

## 4. リリース（審査提出）

1. 左メニューの **公開 > 製品版 (Production)** を選択します。
    - ※まずは「内部テスト (Internal testing)」で自分だけで確認することをお勧めしますが、リリースの流れは同じです。
2. **新しいリリースを作成** を押します。
3. **App Bundle** の欄に、手順2で作成した `.aab` ファイルをドラッグ＆ドロップします。
4. リリース名（例: `1.0.0`）とリリースノート（例: 「リリースしました！」）を入力します。
5. **次へ** を押し、警告がないか確認して **保存**。
6. **リリースのレビュー** 画面で **製品版としての公開を開始**（または審査へ送信）を押します。

この後、Googleによる審査（通常数日〜1週間程度）が行われ、問題なければストアに公開されます。

## 5. リリース後のアップデート手順

アプリを修正・機能追加して更新版をリリースする手順です。
ユーザーがGoogle Playストアの「アプリの自動更新」を有効にしている場合（デフォルトで有効）、**Wi-Fi接続時などに自動的に新しいバージョンがダウンロード・インストールされます**（いわゆるOTA/Over-The-Air配信と同様の挙動ですが、ストアを経由します）。

### 5.1 バージョン番号の更新（必須）

Google Playでは、**「Version Code」が前回より増えていないとアップロードを受け付けてくれません**。

1. **Android Studio** でプロジェクトを開きます。
2. 左側のファイルツリーから `app` > `build.gradle` (Module: app) を開きます。
3. `defaultConfig` ブロック内の以下の数値を変更します。
    - `versionCode`: **必ず +1 する**（例: `1` → `2`）
    - `versionName`: ユーザーに見えるバージョン（例: `1.0.0` → `1.1.0`）
4. 右上の「Sync Now」を押して変更を反映させます。

### 5.2 ビルドと提出

1. コードを修正し、Webビルドを更新します。
   ```bash
   npm run build
   npx cap sync
   ```
2. Android Studioで **Generate Signed Bundle / APK** を実行します（手順2と同じ）。
   - **注意**: 初回作成時と同じ **Key store** ファイルとパスワードを使用してください。これらが異なるとアップデートとして認識されません。
3. Play Consoleで以前と同じアプリを選択し、**公開 > 製品版** に移動します。
4. **新しいリリースを作成** を押し、新しい `.aab` ファイルをアップロードします。
5. 審査に提出します。
